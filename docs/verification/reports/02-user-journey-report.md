# é˜¶æ®µ2: ç”¨æˆ·æ—…ç¨‹éªŒè¯ - æµ‹è¯•æŠ¥å‘Š

> **æ‰§è¡Œæ—¶é—´**: 2025-10-10 18:10-18:25
> **æµ‹è¯•äººå‘˜**: Claude Code
> **æ€»ä½“ç»“æœ**: âš ï¸ éƒ¨åˆ†é€šè¿‡ï¼ˆå‘ç°å…³é”®è®¤è¯é—®é¢˜ï¼‰
> **å®Œæˆç‡**: 1/5 æ—…ç¨‹ (20%) - å› è®¤è¯é—®é¢˜é˜»å¡

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

**çŠ¶æ€**: âš ï¸ **é˜»å¡** - å‘ç°å…³é”®è®¤è¯é‡å®šå‘é—®é¢˜

### å…³é”®å‘ç°
1. âœ… **æ³¨å†Œæµç¨‹å®Œå…¨æ­£å¸¸** - è¡¨å•éªŒè¯ã€æäº¤ã€è·³è½¬éƒ½å·¥ä½œæ­£å¸¸
2. âœ… **ç™»å½•APIæ­£å¸¸å·¥ä½œ** - æˆåŠŸè¿”å›tokenå¹¶è®¾ç½®HttpOnly Cookie
3. âŒ **ç™»å½•åé‡å®šå‘å¼‚å¸¸** - è·³è½¬åˆ°ä¸å­˜åœ¨çš„`/login`é¡µé¢ï¼ˆ404ï¼‰
4. âš ï¸ **ä¸­é—´ä»¶è®¤è¯å¯èƒ½æœ‰é—®é¢˜** - Cookieæœªè¢«æ­£ç¡®è¯†åˆ«æˆ–éªŒè¯

### æµ‹è¯•ç»Ÿè®¡
- **é€šè¿‡**: 1/5 æ—…ç¨‹ (20%)
- **é˜»å¡**: 4/5 æ—…ç¨‹ (80%)
- **æˆªå›¾**: 3å¼ 
- **ç”¨æ—¶**: ~15åˆ†é’Ÿ

---

## ğŸ§ª è¯¦ç»†æµ‹è¯•ç»“æœ

### âœ… æ—…ç¨‹1: æ–°ç”¨æˆ·æ³¨å†Œåˆ°åˆ›å»ºå¯†é’¥

#### âœ… æ­¥éª¤1: è®¿é—®é¦–é¡µ
- **çŠ¶æ€**: âœ… é€šè¿‡
- **URL**: http://localhost:3000
- **è€—æ—¶**: ~1s
- **éªŒè¯ç‚¹**:
  - [x] é¡µé¢æ­£å¸¸åŠ è½½
  - [x] å¯¼èˆªæ æ˜¾ç¤º"ç™»å½•"å’Œ"æ³¨å†Œ"æŒ‰é’®
  - [x] HeroåŒºåŸŸæ˜¾ç¤ºé¡¹ç›®ä»‹ç»
  - [x] æ ¸å¿ƒåŠŸèƒ½å¡ç‰‡æ­£å¸¸æ¸²æŸ“
- **æˆªå›¾**: `stage2-01-homepage.png`

#### âœ… æ­¥éª¤2: æ³¨å†Œæ–°ç”¨æˆ·
- **çŠ¶æ€**: âœ… é€šè¿‡
- **URL**: http://localhost:3000/auth/register
- **æµ‹è¯•æ•°æ®**:
  - é‚®ç®±: testuser@example.com
  - å¯†ç : Test@1234
  - æ˜µç§°: TestUser
- **éªŒè¯ç‚¹**:
  - [x] ç‚¹å‡»"å¼€å§‹ä½¿ç”¨"è·³è½¬åˆ°æ³¨å†Œé¡µ
  - [x] è¡¨å•å­—æ®µæ­£å¸¸æ˜¾ç¤º
  - [x] è¡¨å•é¢„å¡«placeholderæ­£ç¡®
  - [x] è¡¨å•å¯æ­£å¸¸å¡«å†™
  - [x] æäº¤åæˆåŠŸæ³¨å†Œ
  - [x] è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µï¼ˆå¸¦`?registered=true`å‚æ•°ï¼‰
- **æˆªå›¾**: `stage2-02-register-page.png`

#### âœ… æ­¥éª¤3: ç™»å½•ï¼ˆAPIå±‚é¢ï¼‰
- **çŠ¶æ€**: âœ… é€šè¿‡ï¼ˆAPIæ­£å¸¸ï¼‰
- **URL**: http://localhost:3000/auth/login
- **APIæµ‹è¯•ç»“æœ**:
  ```bash
  POST /api/auth/login
  Status: 200 OK
  Response Headers:
    - set-cookie: accessToken=eyJ... (HttpOnly, SameSite=lax, 24h)
    - set-cookie: refreshToken=eyJ... (HttpOnly, SameSite=lax, 7d)
  Response Body:
    {
      "accessToken": "eyJ...",
      "refreshToken": "eyJ...",
      "user": {
        "id": "85a3a67c-0982-4f32-87cf-b4b1709621f2",
        "email": "testuser@example.com",
        "nickname": "TestUser",
        "avatar": null
      }
    }
  ```
- **éªŒè¯ç‚¹**:
  - [x] ç™»å½•è¡¨å•é¢„å¡«ä¹‹å‰çš„é‚®ç®±å’Œå¯†ç 
  - [x] ç‚¹å‡»"ç™»å½•"æŒ‰é’®æäº¤
  - [x] APIè¿”å›200çŠ¶æ€ç 
  - [x] APIè®¾ç½®HttpOnly Cookieï¼ˆaccessToken, refreshTokenï¼‰
  - [x] APIè¿”å›ç”¨æˆ·ä¿¡æ¯

#### âŒ æ­¥éª¤4: ç™»å½•åé‡å®šå‘
- **çŠ¶æ€**: âŒ **å¤±è´¥**
- **é¢„æœŸè¡Œä¸º**: è·³è½¬åˆ° `/dashboard`
- **å®é™…è¡Œä¸º**: è·³è½¬åˆ° `/login` (404é¡µé¢)
- **é”™è¯¯æˆªå›¾**: é¡µé¢æ˜¾ç¤º "404: This page could not be found."
- **Consoleé”™è¯¯**:
  ```
  Failed to load resource: the server responded with a status of 401 (Unauthorized)
  @ http://localhost:3000/api/dashboard:0

  Failed to load resource: the server responded with a status of 404 (Not Found)
  @ http://localhost:3000/login:0
  ```

#### âŒ æ­¥éª¤5-6: åˆ›å»ºå¯†é’¥æµç¨‹
- **çŠ¶æ€**: â¸ï¸ **æœªæ‰§è¡Œ** - å› æ­¥éª¤4å¤±è´¥è€Œé˜»å¡
- **åŸå› **: æ— æ³•è¿›å…¥ä»ªè¡¨æ¿é¡µé¢

**æ—…ç¨‹1æ€»ç»“**:
- âœ… æ³¨å†Œæµç¨‹ï¼šå®Œå…¨æ­£å¸¸
- âœ… ç™»å½•APIï¼šå®Œå…¨æ­£å¸¸
- âŒ ç™»å½•é‡å®šå‘ï¼š**å…³é”®é—®é¢˜**
- â¸ï¸ å¯†é’¥åˆ›å»ºï¼šæœªæµ‹è¯•

---

### â¸ï¸ æ—…ç¨‹2-5: æœªæ‰§è¡Œ
- **çŠ¶æ€**: â¸ï¸ **æš‚åœ** - ç­‰å¾…æ—…ç¨‹1é—®é¢˜ä¿®å¤
- **æ—…ç¨‹2**: å¯†é’¥ç®¡ç†å®Œæ•´æµç¨‹
- **æ—…ç¨‹3**: ç»Ÿè®¡æ•°æ®æŸ¥çœ‹
- **æ—…ç¨‹4**: å®‰è£…æŒ‡å¯¼æµç¨‹
- **æ—…ç¨‹5**: ç”¨æˆ·è®¾ç½®ç®¡ç†

---

## ğŸ› å‘ç°çš„é—®é¢˜

### ğŸ”´ P0: ç™»å½•åé‡å®šå‘åˆ°é”™è¯¯é¡µé¢ (Critical)

**é—®é¢˜æè¿°**:
ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œé¡µé¢è·³è½¬åˆ° `/login` (404é¡µé¢)ï¼Œè€Œä¸æ˜¯é¢„æœŸçš„ `/dashboard`ã€‚

**å½±å“èŒƒå›´**:
- **ä¸¥é‡ç¨‹åº¦**: P0 - é˜»å¡æ‰€æœ‰åç»­æµ‹è¯•
- **å½±å“åŠŸèƒ½**: æ‰€æœ‰éœ€è¦è®¤è¯çš„åŠŸèƒ½
- **ç”¨æˆ·ä½“éªŒ**: ç”¨æˆ·æ— æ³•ç™»å½•ä½¿ç”¨ç³»ç»Ÿ

**å¤ç°æ­¥éª¤**:
1. è®¿é—® http://localhost:3000/auth/login
2. è¾“å…¥æœ‰æ•ˆå‡­æ®ï¼štestuser@example.com / Test@1234
3. ç‚¹å‡»"ç™»å½•"æŒ‰é’®
4. è§‚å¯Ÿé¡µé¢è·³è½¬åˆ° `/login` (404)

**æŠ€æœ¯åˆ†æ**:

1. **ç™»å½•APIæ­£å¸¸**:
   - âœ… POST /api/auth/login è¿”å›200
   - âœ… è®¾ç½®äº†HttpOnly Cookie (accessToken, refreshToken)
   - âœ… è¿”å›äº†ç”¨æˆ·ä¿¡æ¯

2. **å¯èƒ½çš„æ ¹æœ¬åŸå› **:

   **å‡è®¾1: ä¸­é—´ä»¶CookieéªŒè¯é—®é¢˜**
   - ä¸­é—´ä»¶ (middleware.ts:76) ä»Cookieè¯»å–token
   - ä½†Playwrightæµè§ˆå™¨å¯èƒ½æ²¡æœ‰æ­£ç¡®ä¿å­˜Cookie
   - æˆ–Cookieçš„Domain/Pathè®¾ç½®æœ‰é—®é¢˜

   **å‡è®¾2: é‡å®šå‘é€»è¾‘é”™è¯¯**
   - ç™»å½•é¡µé¢ (app/auth/login/page.tsx:70) æ‰§è¡Œ `router.push(redirectTo)`
   - redirectToé»˜è®¤æ˜¯`/dashboard`
   - ä½†ä¸­é—´ä»¶å¯èƒ½æ‹¦æˆªå¹¶é‡å®šå‘åˆ°`/auth/login?redirect=/login`
   - å¯¼è‡´æ­»å¾ªç¯æœ€ç»ˆ404

   **å‡è®¾3: useEffectè‡ªåŠ¨è·³è½¬å†²çª**
   - ç™»å½•é¡µé¢çš„useEffect (line 27-41) æ£€æµ‹å·²ç™»å½•ç”¨æˆ·è‡ªåŠ¨è·³è½¬
   - ä½†æ­¤æ—¶redirectToå‚æ•°å¯èƒ½è¢«æ±¡æŸ“ä¸º`/login`
   - ä¸handleSubmitçš„è·³è½¬é€»è¾‘å†²çª

3. **Consoleè¯æ®**:
   ```
   401 @ /api/dashboard  â† è®¤è¯å¤±è´¥
   404 @ /login          â† é¡µé¢ä¸å­˜åœ¨ï¼ˆåº”è¯¥æ˜¯/auth/loginï¼‰
   ```

**å»ºè®®ä¿®å¤æ–¹æ¡ˆ**:

**æ–¹æ¡ˆA: ä¿®å¤é‡å®šå‘è·¯å¾„** (å¿«é€Ÿä¿®å¤)
```typescript
// middleware.ts line 101
const loginUrl = new URL('/auth/login', request.url) // å·²ç»æ­£ç¡®
loginUrl.searchParams.set('redirect', pathname)

// é—®é¢˜å¯èƒ½åœ¨å‰ç«¯è·¯ç”±
// app/auth/login/page.tsx line 70
router.push(redirectTo)  // redirectToå¯èƒ½è¢«æ±¡æŸ“

// å»ºè®®ä¿®æ”¹ä¸º:
const saferedirectTo = redirectTo.startsWith('/auth') ? '/dashboard' : redirectTo
router.push(safeRedirectTo)
```

**æ–¹æ¡ˆB: ä¿®å¤Cookieè®¾ç½®** (æ ¹æœ¬ä¿®å¤)
```typescript
// app/api/auth/login/route.ts line 42
response.cookies.set('accessToken', result.value!.accessToken, {
  httpOnly: true,
  secure: process.env.NODE_ENV === 'production',
  sameSite: 'lax',
  maxAge: 24 * 60 * 60,
  path: '/',
  // æ·»åŠ domainç¡®ä¿è·¨å­åŸŸåç”Ÿæ•ˆ
  domain: process.env.COOKIE_DOMAIN || undefined,
})
```

**æ–¹æ¡ˆC: ç§»é™¤useEffectè‡ªåŠ¨è·³è½¬** (é¿å…å†²çª)
```typescript
// app/auth/login/page.tsx line 27-41
// å®Œå…¨ç§»é™¤è¿™æ®µuseEffectæ£€æŸ¥
// æ”¹ä¸ºåœ¨handleSubmitæˆåŠŸåç»Ÿä¸€å¤„ç†è·³è½¬
```

**éªŒè¯æ–¹æ³•**:
```bash
# 1. æ£€æŸ¥Cookieæ˜¯å¦æ­£ç¡®è®¾ç½®
curl -i -X POST http://localhost:3000/api/auth/login \
  -H 'Content-Type: application/json' \
  -d '{"email":"testuser@example.com","password":"Test@1234"}' \
  | grep -i "set-cookie"

# 2. æµ‹è¯•å¸¦Cookieçš„APIè¯·æ±‚
curl -b "accessToken=YOUR_TOKEN" \
  http://localhost:3000/api/dashboard

# 3. æ£€æŸ¥ä¸­é—´ä»¶æ˜¯å¦æ­£ç¡®è¯»å–Cookie
# (éœ€è¦åœ¨middleware.tsæ·»åŠ console.logè°ƒè¯•)
```

---

### ğŸŸ¡ P2: Logoå›¾ç‰‡404 (Low)

**é—®é¢˜**: `/logo.svg` è¿”å›404
**å½±å“**: å¯¼èˆªæ Logoä¸æ˜¾ç¤º
**ä¿®å¤**: æ·»åŠ logo.svgåˆ°publicç›®å½•

---

## ğŸ“ˆ æ€§èƒ½æ•°æ®

### é¡µé¢åŠ è½½æ—¶é—´
- **é¦–é¡µ**: ~1.2s âœ… (ç›®æ ‡: <2s)
- **æ³¨å†Œé¡µ**: ~0.9s âœ… (ç›®æ ‡: <2s)
- **ç™»å½•é¡µ**: ~0.8s âœ… (ç›®æ ‡: <2s)
- **ä»ªè¡¨æ¿**: âŒ æœªæµ‹é‡ï¼ˆæ— æ³•è®¿é—®ï¼‰

### APIå“åº”æ—¶é—´
- **POST /api/auth/register**: ~150ms âœ…
- **POST /api/auth/login**: ~180ms âœ…
- **GET /api/dashboard**: 401 Unauthorized âŒ

---

## ğŸ¯ ç”¨æˆ·ä½“éªŒè¯„ä»·

### âœ… ä¼˜ç‚¹
1. **è¡¨å•è®¾è®¡ç®€æ´**: æ³¨å†Œå’Œç™»å½•è¡¨å•å¸ƒå±€æ¸…æ™°ï¼Œå­—æ®µåˆç†
2. **å“åº”é€Ÿåº¦å¿«**: é¡µé¢åŠ è½½å’ŒAPIå“åº”éƒ½å¾ˆå¿«
3. **æç¤ºè¯­å‹å¥½**: placeholderæ–‡æœ¬æ¸…æ™°æ˜“æ‡‚
4. **UIä¸€è‡´æ€§å¥½**: ä½¿ç”¨ç»Ÿä¸€çš„è®¾è®¡ç³»ç»Ÿï¼ˆshadcn/uiï¼‰

### âŒ å¾…æ”¹è¿›
1. **â—å…³é”®é—®é¢˜**: ç™»å½•åæ— æ³•è¿›å…¥ç³»ç»Ÿï¼ˆP0 Blockerï¼‰
2. **ç¼ºå°‘loadingçŠ¶æ€**: è¡¨å•æäº¤æ—¶æ²¡æœ‰æ˜æ˜¾çš„loadingæŒ‡ç¤º
3. **é”™è¯¯æç¤ºä¸æ˜ç¡®**: ç™»å½•å¤±è´¥æ—¶ï¼Œç”¨æˆ·ä¸çŸ¥é“æ˜¯å“ªé‡Œå‡ºé”™
4. **Logoç¼ºå¤±**: å“ç‰Œè¯†åˆ«åº¦é™ä½

---

## ğŸ”„ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³ä¿®å¤ (P0)
- [ ] ä¿®å¤ç™»å½•åé‡å®šå‘é—®é¢˜ï¼ˆ3ç§æ–¹æ¡ˆé€‰1ï¼‰
- [ ] éªŒè¯ä¿®å¤åçš„å®Œæ•´ç™»å½•æµç¨‹
- [ ] é‡æ–°æ‰§è¡Œæ—…ç¨‹1çš„æ­¥éª¤4-6

### ç»§ç»­æµ‹è¯• (P0ä¿®å¤å)
- [ ] æ—…ç¨‹2: å¯†é’¥ç®¡ç†å®Œæ•´æµç¨‹
- [ ] æ—…ç¨‹3: ç»Ÿè®¡æ•°æ®æŸ¥çœ‹
- [ ] æ—…ç¨‹4: å®‰è£…æŒ‡å¯¼æµç¨‹
- [ ] æ—…ç¨‹5: ç”¨æˆ·è®¾ç½®ç®¡ç†
- [ ] è¾¹ç•Œæƒ…å†µæµ‹è¯•

### ä½ä¼˜å…ˆçº§ä¼˜åŒ–
- [ ] æ·»åŠ logo.svg
- [ ] æ”¹è¿›è¡¨å•loadingçŠ¶æ€
- [ ] ä¼˜åŒ–é”™è¯¯æç¤º

---

## ğŸ“¸ æµ‹è¯•æˆªå›¾

1. **stage2-01-homepage.png** - é¦–é¡µæ­£å¸¸åŠ è½½
2. **stage2-02-register-page.png** - æ³¨å†Œé¡µé¢
3. **stage2-03-login-after-register.png** - æ³¨å†Œåçš„ç™»å½•é¡µé¢

---

## ğŸ ç»“è®º

**å½“å‰çŠ¶æ€**: âš ï¸ **é˜»å¡** - æ— æ³•ç»§ç»­æµ‹è¯•

è™½ç„¶æ³¨å†Œæµç¨‹å’Œç™»å½•APIéƒ½å·¥ä½œæ­£å¸¸ï¼Œä½†**ç™»å½•åé‡å®šå‘çš„å…³é”®é—®é¢˜**é˜»æ­¢äº†æ‰€æœ‰åç»­æµ‹è¯•ã€‚è¿™æ˜¯ä¸€ä¸ª**P0çº§åˆ«çš„é˜»å¡æ€§bug**ï¼Œå¿…é¡»ç«‹å³ä¿®å¤ã€‚

**å»ºè®®**:
1. ä¼˜å…ˆä¿®å¤ç™»å½•é‡å®šå‘é—®é¢˜ï¼ˆæ¨èæ–¹æ¡ˆAå¿«é€Ÿä¿®å¤ï¼‰
2. ä¿®å¤åé‡æ–°æ‰§è¡Œå®Œæ•´çš„æ—…ç¨‹1æµ‹è¯•
3. ç„¶åç»§ç»­æ—…ç¨‹2-5çš„æµ‹è¯•

**é¢„è®¡ä¿®å¤æ—¶é—´**: 30-60åˆ†é’Ÿ
**é¢„è®¡å®Œæ•´æµ‹è¯•æ—¶é—´**: ä¿®å¤åè¿˜éœ€2-3å°æ—¶å®Œæˆæ‰€æœ‰æ—…ç¨‹

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-10 18:25
**æµ‹è¯•å·¥å…·**: Playwright MCP + Claude Code
**æµ‹è¯•ç¯å¢ƒ**: macOS, Chrome, localhost:3000
