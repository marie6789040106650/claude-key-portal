# 阶段2️⃣: 浏览器用户旅程验证

> **项目**: Claude Key Portal
> **路径**: `/Users/bypasser/claude-project/0930/claude-key-portal`
> **分支**: `verification/comprehensive-test`
> **当前阶段**: 2/4
> **预计时间**: 90-120分钟

---

## 🎯 本阶段目标

使用Playwright模拟真实用户操作流程，验证：
- ✅ UI交互流畅自然
- ✅ 所有核心功能可完整执行
- ✅ 错误提示清晰友好
- ✅ 边界情况处理正确
- ✅ 页面加载时间 < 2s

---

## 📋 核心用户旅程

### 旅程1: 新用户注册到创建密钥 (20分钟)

**目标**: 验证首次使用的完整体验

#### 步骤1: 访问首页
- [ ] 打开 http://localhost:3000
- [ ] 页面正常加载，无JavaScript错误
- [ ] 导航栏显示"登录"和"注册"按钮
- [ ] Hero区域显示项目介绍

**Playwright命令**:
```typescript
// 使用mcp__playwright__browser_navigate
await browser_navigate({ url: 'http://localhost:3000' })

// 使用mcp__playwright__browser_snapshot
await browser_snapshot()
```

#### 步骤2: 注册新用户
- [ ] 点击"开始使用"或"注册"按钮
- [ ] 跳转到 `/auth/register`
- [ ] 填写邮箱、密码、昵称
- [ ] 提交注册表单
- [ ] 显示注册成功提示
- [ ] 自动跳转到登录页面

**预期结果**:
- 表单验证工作正常（实时错误提示）
- 密码强度指示器显示
- 注册成功后有友好提示

#### 步骤3: 登录
- [ ] 在登录页面输入刚注册的凭据
- [ ] 点击"登录"按钮
- [ ] 登录成功，跳转到 `/dashboard`
- [ ] 显示欢迎提示（首次登录）

#### 步骤4: 首次进入仪表板
- [ ] 仪表板页面正常渲染
- [ ] 显示"暂无密钥"提示
- [ ] 显示"创建第一个密钥"的引导

#### 步骤5: 创建第一个密钥
- [ ] 点击"创建密钥"按钮
- [ ] 打开创建密钥对话框
- [ ] 填写密钥名称和描述
- [ ] 提交创建
- [ ] 显示密钥创建成功（包含完整密钥，仅此一次）
- [ ] 显示警告：请立即保存此密钥

#### 步骤6: 查看密钥列表
- [ ] 关闭密钥创建对话框
- [ ] 密钥列表中显示新创建的密钥
- [ ] 密钥卡片显示：名称、脱敏的密钥值、状态、创建时间

**通过标准**:
- 整个流程无阻塞错误
- 所有提示信息清晰
- 操作响应时间 < 2s

---

### 旅程2: 密钥管理完整流程 (30分钟)

**目标**: 验证密钥的所有管理操作

#### 步骤1: 查看密钥列表
- [ ] 进入 `/dashboard/keys`
- [ ] 列表显示所有用户密钥
- [ ] 每个密钥卡片显示关键信息

#### 步骤2: 搜索和筛选
- [ ] 使用搜索框搜索密钥名称
- [ ] 结果实时过滤
- [ ] 使用状态筛选器（全部/活跃/已禁用）
- [ ] 筛选生效

#### 步骤3: 点击密钥查看详情
- [ ] 点击密钥卡片
- [ ] 跳转到密钥详情页 `/dashboard/keys/[id]`
- [ ] 显示完整信息：名称、描述、标签、使用统计
- [ ] **不显示完整密钥值**（仅显示脱敏版本）

#### 步骤4: 重命名密钥
- [ ] 点击"重命名"按钮
- [ ] 输入新名称
- [ ] 保存修改
- [ ] 显示成功提示
- [ ] 页面更新为新名称

#### 步骤5: 更新描述/备注
- [ ] 点击"编辑备注"
- [ ] 输入或修改备注内容
- [ ] 保存修改
- [ ] 备注更新显示

#### 步骤6: 添加标签
- [ ] 点击"添加标签"
- [ ] 输入标签名称（如"production"）
- [ ] 保存标签
- [ ] 标签显示在密钥信息中
- [ ] 重复添加多个标签

#### 步骤7: 删除标签
- [ ] 点击标签上的删除按钮
- [ ] 标签从列表中移除

#### 步骤8: 收藏密钥
- [ ] 点击收藏（星标）按钮
- [ ] 星标变为实心（已收藏）
- [ ] 再次点击取消收藏
- [ ] 星标变为空心（未收藏）

#### 步骤9: 切换密钥状态
- [ ] 点击"禁用密钥"按钮
- [ ] 显示确认对话框
- [ ] 确认禁用
- [ ] 密钥状态更新为"已禁用"
- [ ] 再次启用密钥

#### 步骤10: 查看使用统计
- [ ] 点击"查看统计"或直接访问 `/dashboard/keys/[id]/stats`
- [ ] 图表正常渲染（如有数据）
- [ ] 显示调用次数、Token使用量等
- [ ] 时间范围选择器工作正常

**通过标准**:
- 所有操作流畅完成
- UI响应及时
- 数据更新正确显示

---

### 旅程3: 统计数据查看 (20分钟)

**目标**: 验证数据展示和图表渲染

#### 步骤1: 查看仪表板概览
- [ ] 访问 `/dashboard`
- [ ] 概览卡片显示：总密钥数、活跃密钥、总调用次数、总Token数
- [ ] 数据与实际一致
- [ ] 图表组件正常渲染（如有数据）

#### 步骤2: 查看详细统计
- [ ] 进入 `/dashboard/stats`
- [ ] 使用量趋势图正常显示
- [ ] 时间范围选择器工作（7天/30天/全部）
- [ ] 切换时间范围，数据更新

#### 步骤3: 密钥对比
- [ ] 选择多个密钥进行对比
- [ ] 对比图表正确渲染
- [ ] 数据标签清晰

#### 步骤4: 查看排行榜
- [ ] 排行榜按使用量正确排序
- [ ] 显示前N个密钥

**通过标准**:
- 图表库正常工作（无渲染错误）
- 数据准确性（与API返回一致）
- 交互流畅

---

### 旅程4: 安装指导流程 (15分钟)

**目标**: 验证配置生成和安装说明

#### 步骤1: 进入安装页面
- [ ] 访问 `/dashboard/install`
- [ ] 页面显示安装指导

#### 步骤2: 选择密钥
- [ ] 从下拉列表选择要安装的密钥
- [ ] 密钥列表显示用户所有密钥

#### 步骤3: 选择平台
- [ ] 选择平台（Cursor/Continue/VSCode）
- [ ] 选择环境（Development/Production）

#### 步骤4: 生成配置
- [ ] 点击"生成配置"按钮
- [ ] 显示生成的配置内容
- [ ] 显示分步安装说明

#### 步骤5: 复制配置
- [ ] 点击"复制"按钮
- [ ] 显示"已复制"提示
- [ ] 实际测试复制功能（粘贴到文本编辑器验证）

#### 步骤6: 切换平台
- [ ] 切换到不同平台
- [ ] 配置内容相应更新
- [ ] 安装说明更新

**通过标准**:
- 配置生成正确
- 复制功能正常
- 说明清晰易懂

---

### 旅程5: 用户设置管理 (15分钟)

**目标**: 验证账户设置功能

#### 步骤1: 进入设置页面
- [ ] 点击用户头像/设置按钮
- [ ] 进入 `/dashboard/settings`
- [ ] 显示设置导航（个人信息/安全/通知等）

#### 步骤2: 查看个人信息
- [ ] 选择"个人信息"标签
- [ ] 显示当前用户信息（邮箱、昵称、头像）
- [ ] 所有字段可编辑

#### 步骤3: 更新昵称
- [ ] 修改昵称字段
- [ ] 点击"保存"按钮
- [ ] 显示保存成功提示
- [ ] 导航栏的用户名更新

#### 步骤4: 修改密码
- [ ] 选择"安全"标签
- [ ] 点击"修改密码"
- [ ] 输入旧密码、新密码、确认密码
- [ ] 提交修改
- [ ] 显示成功提示

#### 步骤5: 查看会话管理
- [ ] 查看当前登录设备列表（如实现）
- [ ] 显示设备信息、IP、最后活动时间

**通过标准**:
- 设置保存成功
- 数据更新反映到UI

---

## 🧪 边界情况测试

### 未授权访问
- [ ] 未登录访问 `/dashboard` → 重定向到 `/auth/login`
- [ ] 未登录访问 `/dashboard/keys` → 重定向到 `/auth/login`
- [ ] 登录后正确返回原页面

### 表单验证
- [ ] 注册：邮箱格式验证
- [ ] 注册：密码强度验证（最少8字符，包含大小写、数字、特殊符号）
- [ ] 登录：空字段提示
- [ ] 创建密钥：名称必填验证

### 错误处理
- [ ] 网络错误：显示友好提示（模拟断网）
- [ ] API错误：显示具体错误信息（如"密钥名称已存在"）
- [ ] 超时处理：显示加载超时提示

### 性能
- [ ] 首页加载时间 < 2s
- [ ] 仪表板加载时间 < 2s
- [ ] 密钥列表加载时间 < 1s
- [ ] API请求响应时间 < 500ms

---

## ✅ 通过标准

- [x] **所有核心旅程完整执行，无阻塞错误**
- [x] UI交互流畅，响应及时
- [x] 错误提示清晰友好
- [x] 边界情况处理正确
- [x] 页面加载时间 < 2s
- [x] 无JavaScript控制台错误
- [x] 数据更新正确反映到UI

---

## 📝 输出要求

创建用户旅程测试报告: `docs/verification/reports/02-user-journey-report.md`

**报告模板**:
```markdown
# 阶段2: 用户旅程验证 - 报告

## 执行摘要
- **执行时间**: 2025-10-10 HH:mm
- **总体结果**: ✅ 通过 / ⚠️ 部分通过 / ❌ 失败
- **完成率**: X/5 旅程 (XX%)

## 详细测试结果

### 旅程1: 新用户注册到创建密钥 (✅通过)
- [x] 步骤1: 访问首页 - 通过
- [x] 步骤2: 注册新用户 - 通过
- [x] 步骤3: 登录 - 通过
- [x] 步骤4: 首次进入仪表板 - 通过
- [x] 步骤5: 创建第一个密钥 - 通过
- [x] 步骤6: 查看密钥列表 - 通过

**用时**: XXX秒
**截图**: [附上关键步骤截图]

### 旅程2: 密钥管理完整流程 (✅通过)
...

### 边界情况测试
- [x] ✅ 未授权访问处理
- [x] ✅ 表单验证
- [x] ✅ 错误处理
- [x] ✅ 性能要求

## 发现的问题
[列出所有发现的问题，按优先级分类]

## 性能数据
- 首页加载: XXXms
- 仪表板加载: XXXms
- 密钥列表加载: XXXms

## 用户体验评价
1. **优点**: ...
2. **待改进**: ...

## 建议
1. ...
2. ...
```

---

## 🔄 下一步

完成本阶段后，执行：

```bash
# 保存报告
git add docs/verification/reports/02-user-journey-report.md
git commit -m "docs: add user journey validation report"

# 标记完成，自动进入阶段3
claude-monitor done
```

10秒后将自动打开新终端，加载阶段3提示词：
`docs/verification/prompts/stage3-frontend-backend-match.md`

---

## 💡 使用Playwright MCP工具

### 基本操作
```typescript
// 导航到页面
mcp__playwright__browser_navigate({ url: 'http://localhost:3000' })

// 获取页面快照
mcp__playwright__browser_snapshot()

// 点击元素
mcp__playwright__browser_click({
  element: '登录按钮',
  ref: 'button#login'
})

// 输入文本
mcp__playwright__browser_type({
  element: '邮箱输入框',
  ref: 'input[type="email"]',
  text: 'test@example.com'
})

// 截图
mcp__playwright__browser_take_screenshot({
  filename: 'dashboard.png'
})
```

---

**参考文档**:
- HTML原型: `prototypes/*.html`
- 主计划: `docs/verification/VERIFICATION_MASTER_PLAN.md`
