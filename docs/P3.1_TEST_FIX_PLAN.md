# P3.1 - æµ‹è¯•ä¿®å¤è¡ŒåŠ¨è®¡åˆ’

> **åˆ›å»ºæ—¶é—´**: 2025-10-10
> **ç›®æ ‡**: æå‡æµ‹è¯•é€šè¿‡ç‡ä»52%åˆ°80%+
> **å·¥ä½œé‡**: 2-3å¤©
> **ä¼˜å…ˆçº§**: â­â­â­ æœ€é«˜

---

## ğŸ“Š å½“å‰æµ‹è¯•çŠ¶æ€

```
æµ‹è¯•é€šè¿‡ç‡: 52% (504/969)
â”œâ”€â”€ é€šè¿‡: 504ä¸ª
â”œâ”€â”€ å¤±è´¥: 51ä¸ª  â† éœ€è¦ä¿®å¤
â””â”€â”€ è·³è¿‡: 414ä¸ª â† éœ€è¦å¯ç”¨

æµ‹è¯•å¥—ä»¶çŠ¶æ€:
â”œâ”€â”€ é€šè¿‡: 34ä¸ª
â”œâ”€â”€ å¤±è´¥: 17ä¸ª
â””â”€â”€ è·³è¿‡: 17ä¸ª
```

---

## ğŸ¯ ä¿®å¤ç›®æ ‡

### é˜¶æ®µç›®æ ‡
- [ ] æµ‹è¯•é€šè¿‡ç‡ â‰¥ 80% (è‡³å°‘775/969)
- [ ] ä¿®å¤æ‰€æœ‰å¤±è´¥çš„æµ‹è¯• (51ä¸ª)
- [ ] å¯ç”¨å…³é”®è·³è¿‡æµ‹è¯• (è¯„ä¼°å)
- [ ] æµ‹è¯•æ‰§è¡Œæ—¶é—´ < 30ç§’

---

## ğŸ“‹ é—®é¢˜åˆ†ç±»åˆ†æ

### Task 1: Mockç›¸å…³æµ‹è¯•ä¿®å¤ (é¢„è®¡1å¤©)

**é—®é¢˜åˆ†æ**:
```bash
# æŸ¥çœ‹å¤±è´¥çš„æµ‹è¯•
npm test 2>&1 | grep -A 3 "FAIL"
```

**å¸¸è§é—®é¢˜**:
1. **Toast Mocké—®é¢˜**
   - `useToast` mockä¸æ­£ç¡®
   - Toastç»„ä»¶æ¸²æŸ“å¤±è´¥
   - è§£å†³æ–¹æ¡ˆ: ç»Ÿä¸€Toast mocké…ç½®

2. **å®šæ—¶å™¨é—®é¢˜**
   - `setTimeout/setInterval`æœªæ­£ç¡®mock
   - å¼‚æ­¥çŠ¶æ€æ›´æ–°æµ‹è¯•å¤±è´¥
   - è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨`jest.useFakeTimers()`

3. **äº‹ä»¶å¤„ç†é—®é¢˜**
   - é”®ç›˜/é¼ æ ‡äº‹ä»¶æœªè§¦å‘
   - äº‹ä»¶ç›‘å¬å™¨æœªæ¸…ç†
   - è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨`@testing-library/user-event`

**ä¿®å¤æ­¥éª¤**:
```bash
# 1. è¯†åˆ«å¤±è´¥æµ‹è¯•
npm test -- --listTests | grep -E "(toast|timer|event)"

# 2. é€ä¸ªä¿®å¤
npm test -- <test-file-path>

# 3. éªŒè¯ä¿®å¤
npm test -- --coverage
```

---

### Task 2: è·³è¿‡æµ‹è¯•è¯„ä¼° (é¢„è®¡1å¤©)

**è·³è¿‡åŸå› åˆ†æ**:
- `it.skip()` - å¼€å‘æ—¶ä¸´æ—¶è·³è¿‡
- `describe.skip()` - æ•´ä¸ªå¥—ä»¶è·³è¿‡
- æ¡ä»¶è·³è¿‡ - ç¯å¢ƒç›¸å…³

**å¤„ç†ç­–ç•¥**:
```typescript
// 1. æŸ¥æ‰¾æ‰€æœ‰è·³è¿‡çš„æµ‹è¯•
grep -r "\.skip\|xit\|xdescribe" tests/

// 2. åˆ†ç±»å¤„ç†
// - å¿…è¦æµ‹è¯•: ä¿®å¤å¹¶å¯ç”¨
// - è¿‡æ—¶æµ‹è¯•: åˆ é™¤
// - ç¯å¢ƒæµ‹è¯•: ä¿æŒè·³è¿‡(CI/CDç›¸å…³)
```

**ä¼˜å…ˆçº§**:
1. â­â­â­ æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æµ‹è¯• - å¿…é¡»å¯ç”¨
2. â­â­ UIäº¤äº’æµ‹è¯• - è¯„ä¼°åå¯ç”¨
3. â­ è¾¹ç•Œæƒ…å†µæµ‹è¯• - å¯ä»¥ä¿æŒè·³è¿‡

---

### Task 3: æµ‹è¯•ç¨³å®šæ€§ä¼˜åŒ– (é¢„è®¡0.5å¤©)

**é—®é¢˜**:
- æµ‹è¯•é—´ç›¸äº’å½±å“
- å¼‚æ­¥æµ‹è¯•ä¸ç¨³å®š
- æµ‹è¯•æ‰§è¡Œæ…¢

**è§£å†³æ–¹æ¡ˆ**:

#### 1. éš”ç¦»æµ‹è¯•ç¯å¢ƒ
```typescript
// æ¯ä¸ªæµ‹è¯•å‰åæ¸…ç†
beforeEach(() => {
  jest.clearAllMocks()
  jest.resetModules()
})

afterEach(() => {
  cleanup()
  jest.clearAllTimers()
})
```

#### 2. ä¿®å¤å¼‚æ­¥æµ‹è¯•
```typescript
// âŒ é”™è¯¯å†™æ³•
test('async test', () => {
  fetchData().then(data => {
    expect(data).toBe('result')
  })
})

// âœ… æ­£ç¡®å†™æ³•
test('async test', async () => {
  const data = await fetchData()
  expect(data).toBe('result')
})
```

#### 3. ä¼˜åŒ–æµ‹è¯•æ€§èƒ½
```typescript
// jest.config.js
{
  maxWorkers: 4, // å¹¶è¡Œæ‰§è¡Œ
  testTimeout: 10000, // 10ç§’è¶…æ—¶
  clearMocks: true,
  resetMocks: true,
}
```

---

## ğŸ”§ å…·ä½“ä¿®å¤æ­¥éª¤

### Day 1: Mockæµ‹è¯•ä¿®å¤

**ä¸Šåˆ (4å°æ—¶)**:
```bash
# 1. Toast Mockç»Ÿä¸€é…ç½®
# åˆ›å»º: tests/setup/toast-mock.ts

# 2. ä¿®å¤Toastç›¸å…³æµ‹è¯•
npm test -- --testPathPattern=toast

# 3. ä¿®å¤å®šæ—¶å™¨æµ‹è¯•
npm test -- --testPathPattern=timer
```

**ä¸‹åˆ (4å°æ—¶)**:
```bash
# 4. ä¿®å¤äº‹ä»¶å¤„ç†æµ‹è¯•
npm test -- --testPathPattern=event

# 5. éªŒè¯ä¿®å¤æ•ˆæœ
npm test -- --coverage
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] Toastæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] å®šæ—¶å™¨æµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] äº‹ä»¶å¤„ç†æµ‹è¯•å…¨éƒ¨é€šè¿‡

---

### Day 2: è·³è¿‡æµ‹è¯•å¤„ç†

**ä¸Šåˆ (4å°æ—¶)**:
```bash
# 1. åˆ—å‡ºæ‰€æœ‰è·³è¿‡æµ‹è¯•
grep -r "\.skip" tests/ > skipped_tests.txt

# 2. åˆ†ç±»è¯„ä¼°
# ç¼–è¾‘skipped_tests.txtï¼Œæ ‡è®°å¤„ç†æ–¹å¼

# 3. å¯ç”¨æ ¸å¿ƒæµ‹è¯•
# ç§»é™¤.skipï¼Œä¿®å¤æµ‹è¯•ä»£ç 
```

**ä¸‹åˆ (4å°æ—¶)**:
```bash
# 4. è¿è¡Œå¯ç”¨çš„æµ‹è¯•
npm test

# 5. ä¿®å¤å¤±è´¥æµ‹è¯•
# é€ä¸ªè§£å†³é—®é¢˜

# 6. åˆ é™¤è¿‡æ—¶æµ‹è¯•
git rm <obsolete-test-files>
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ ¸å¿ƒæµ‹è¯•å…¨éƒ¨å¯ç”¨
- [ ] è¿‡æ—¶æµ‹è¯•å·²åˆ é™¤
- [ ] æµ‹è¯•é€šè¿‡ç‡ > 75%

---

### Day 3: ç¨³å®šæ€§ä¼˜åŒ–ä¸éªŒè¯

**ä¸Šåˆ (3å°æ—¶)**:
```bash
# 1. æ·»åŠ æµ‹è¯•éš”ç¦»
# æ›´æ–°beforeEach/afterEach

# 2. ä¿®å¤å¼‚æ­¥æµ‹è¯•
# ç»Ÿä¸€ä½¿ç”¨async/await

# 3. ä¼˜åŒ–æµ‹è¯•é…ç½®
# æ›´æ–°jest.config.js
```

**ä¸‹åˆ (3å°æ—¶)**:
```bash
# 4. å®Œæ•´æµ‹è¯•è¿è¡Œ
npm test -- --coverage

# 5. CI/CDéªŒè¯
git push origin feature/p3-test-fixes

# 6. æ–‡æ¡£æ›´æ–°
# è®°å½•ä¿®å¤è¿‡ç¨‹å’Œç»“æœ
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æµ‹è¯•é€šè¿‡ç‡ â‰¥ 80%
- [ ] æµ‹è¯•æ‰§è¡Œç¨³å®š
- [ ] CI/CDé€šè¿‡
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ

---

## ğŸ” å¸¸ç”¨è°ƒè¯•å‘½ä»¤

### æŸ¥çœ‹å¤±è´¥æµ‹è¯•
```bash
# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
npm test -- --onlyFailures

# è¯¦ç»†é”™è¯¯ä¿¡æ¯
npm test -- --verbose

# å•ä¸ªæµ‹è¯•æ–‡ä»¶
npm test -- <test-file-path>
```

### æµ‹è¯•è¦†ç›–ç‡
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm test -- --coverage

# æŸ¥çœ‹HTMLæŠ¥å‘Š
open coverage/lcov-report/index.html
```

### æµ‹è¯•æ€§èƒ½åˆ†æ
```bash
# æ˜¾ç¤ºæ‰§è¡Œæ—¶é—´
npm test -- --showSeed --verbose

# è¯†åˆ«æ…¢æµ‹è¯•
npm test 2>&1 | grep -E "[0-9]{4,} ms"
```

---

## âœ… éªŒæ”¶æ¸…å•

### ä»£ç è´¨é‡
- [ ] æµ‹è¯•é€šè¿‡ç‡ â‰¥ 80%
- [ ] æ— è·³è¿‡çš„æ ¸å¿ƒæµ‹è¯•
- [ ] æµ‹è¯•éš”ç¦»è‰¯å¥½
- [ ] å¼‚æ­¥æµ‹è¯•ç¨³å®š

### å·¥ç¨‹è´¨é‡
- [ ] CI/CDç¨³å®šé€šè¿‡
- [ ] æµ‹è¯•æ‰§è¡Œ < 30ç§’
- [ ] è¦†ç›–ç‡æŠ¥å‘Šæ­£å¸¸
- [ ] æ— è­¦å‘Šå’Œé”™è¯¯

### æ–‡æ¡£å®Œæ•´
- [ ] ä¿®å¤è¿‡ç¨‹è®°å½•
- [ ] é—®é¢˜è§£å†³æ–¹æ¡ˆæ–‡æ¡£
- [ ] æµ‹è¯•æœ€ä½³å®è·µæ›´æ–°

---

## ğŸ“ æäº¤è§„èŒƒ

### Gitæäº¤æ ¼å¼
```bash
# ä¿®å¤æµ‹è¯•
git commit -m "test: fix toast mock issues (ğŸ”´ RED)"
git commit -m "test: enable skipped core tests (ğŸŸ¢ GREEN)"
git commit -m "test: optimize test isolation (ğŸ”µ REFACTOR)"

# æ–‡æ¡£æ›´æ–°
git commit -m "docs: add test fix summary"
```

---

## ğŸš€ å¼€å§‹å‘½ä»¤

```bash
# 1. åˆ›å»ºä¿®å¤åˆ†æ”¯
git checkout -b feature/p3-test-fixes

# 2. æŸ¥çœ‹å½“å‰æµ‹è¯•çŠ¶æ€
npm test -- --listTests
npm test 2>&1 | tee test-status.log

# 3. å¼€å§‹ä¿®å¤
# æŒ‰ç…§Day 1 â†’ Day 2 â†’ Day 3é¡ºåºæ‰§è¡Œ

# 4. å®Œæˆååˆå¹¶
git checkout develop
git merge --no-ff feature/p3-test-fixes
git tag -a v1.2.0 -m "P3.1: Test fixes complete"
```

---

## ğŸ“š å‚è€ƒèµ„æº

### æµ‹è¯•å·¥å…·æ–‡æ¡£
- Jest: https://jestjs.io/docs/getting-started
- React Testing Library: https://testing-library.com/docs/react-testing-library/intro
- User Event: https://testing-library.com/docs/user-event/intro

### é¡¹ç›®æ–‡æ¡£
- `DDD_TDD_GIT_STANDARD.md` - TDDæ ‡å‡†
- `CLAUDE.md` - é¡¹ç›®è§„èŒƒ
- `tests/setup/` - æµ‹è¯•é…ç½®

---

**å‡†å¤‡å¥½å¼€å§‹ä¿®å¤äº†å—ï¼Ÿ** ğŸ”§

æ‰§è¡Œ: `git checkout -b feature/p3-test-fixes` å¼€å§‹P3.1ï¼
