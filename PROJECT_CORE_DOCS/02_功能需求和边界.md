# ğŸ¯ åŠŸèƒ½éœ€æ±‚å’Œé¡¹ç›®è¾¹ç•Œ

## æ ¸å¿ƒåŠŸèƒ½

### 1. ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆæœ¬åœ°å®ç°ï¼‰

#### 1.1 ç”¨æˆ·æ³¨å†Œ
```typescript
POST /api/auth/register
{
  email: string;       // é‚®ç®±
  password: string;    // å¯†ç ï¼ˆ8+ å­—ç¬¦ï¼Œå«å¤§å°å†™+æ•°å­—+ç‰¹æ®Šå­—ç¬¦ï¼‰
  name: string;        // ç”¨æˆ·å
}
```

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… é‚®ç®±æ ¼å¼éªŒè¯
- âœ… å¯†ç å¼ºåº¦æ£€æŸ¥
- âœ… é‡å¤é‚®ç®±æ£€æµ‹
- âœ… å¯†ç  bcrypt åŠ å¯†
- âŒ é‚®ç®±éªŒè¯ï¼ˆä¸å®ç°ï¼‰

#### 1.2 ç”¨æˆ·ç™»å½•
```typescript
POST /api/auth/login
{
  email: string;
  password: string;
}

Response:
{
  token: string;       // JWT token
  userId: string;
  expiresAt: number;
}
```

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… JWT ä»¤ç‰Œè®¤è¯
- âœ… Token æœ‰æ•ˆæœŸ 24 å°æ—¶
- âœ… è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
- âœ… å®‰å…¨çš„ä¼šè¯ç®¡ç†

#### 1.3 ä¸ªäººä¸­å¿ƒ
- ä¸ªäººä¿¡æ¯ç¼–è¾‘
- å¤´åƒä¸Šä¼ 
- å¯†ç ä¿®æ”¹
- åå¥½è®¾ç½®ï¼ˆä¸»é¢˜ã€è¯­è¨€ã€æ—¶åŒºï¼‰

---

### 2. å¯†é’¥ç®¡ç†ï¼ˆä»£ç† CRSï¼‰

#### 2.1 åˆ›å»ºå¯†é’¥
```typescript
POST /api/keys
{
  name: string;                    // å¯†é’¥åç§°
  rateLimit?: number;              // é€Ÿç‡é™åˆ¶ï¼ˆæ¬¡/åˆ†é’Ÿï¼‰
  expiresAt?: string;              // è¿‡æœŸæ—¶é—´
  modelRestrictions?: string[];    // æ¨¡å‹é™åˆ¶
  localNotes?: string;             // æœ¬åœ°å¤‡æ³¨
  tags?: string[];                 // æœ¬åœ°æ ‡ç­¾
}
```

**æµç¨‹**:
1. Portal éªŒè¯ç”¨æˆ·è¾“å…¥
2. Portal è°ƒç”¨ CRS Admin API åˆ›å»ºå¯†é’¥
3. CRS è¿”å›å¯†é’¥ä¿¡æ¯
4. Portal åˆ›å»ºæœ¬åœ°æ˜ å°„å…³ç³»ï¼ˆuser_id <-> crs_key_idï¼‰
5. Portal å­˜å‚¨æœ¬åœ°æ‰©å±•å­—æ®µï¼ˆå¤‡æ³¨ã€æ ‡ç­¾ï¼‰

#### 2.2 æŸ¥çœ‹å¯†é’¥åˆ—è¡¨
```typescript
GET /api/keys?page=1&limit=20&status=active&search=xxx

Response:
{
  keys: [
    {
      id: string;               // CRS å¯†é’¥ ID
      key: string;              // å¯†é’¥å­—ç¬¦ä¸²ï¼ˆè„±æ•ï¼‰
      name: string;             // åç§°
      status: string;           // çŠ¶æ€
      todayCalls: number;       // ä»Šæ—¥è°ƒç”¨
      todayTokens: number;      // ä»Šæ—¥ Token
      createdAt: string;

      // æœ¬åœ°æ‰©å±•å­—æ®µ
      localNotes?: string;      // å¤‡æ³¨
      tags?: string[];          // æ ‡ç­¾
      isFavorite?: boolean;     // æ”¶è—
    }
  ],
  total: number;
  page: number;
  limit: number;
}
```

**æ•°æ®æ¥æº**:
- CRS æ•°æ®ï¼šå¯†é’¥ã€çŠ¶æ€ã€ä½¿ç”¨é‡
- æœ¬åœ°æ•°æ®ï¼šå¤‡æ³¨ã€æ ‡ç­¾ã€æ”¶è—

#### 2.3 æŸ¥çœ‹å¯†é’¥è¯¦æƒ…
```typescript
GET /api/keys/:id

Response:
{
  // åŸºç¡€ä¿¡æ¯ï¼ˆæ¥è‡ª CRSï¼‰
  id: string;
  key: string;
  name: string;
  status: 'active' | 'inactive' | 'expired';
  createdAt: string;
  expiresAt?: string;

  // é…ç½®ä¿¡æ¯ï¼ˆæ¥è‡ª CRSï¼‰
  rateLimit: number;
  modelRestrictions: string[];

  // ä½¿ç”¨ç»Ÿè®¡ï¼ˆæ¥è‡ª CRSï¼‰
  totalCalls: number;
  totalTokens: number;
  todayCalls: number;
  todayTokens: number;
  errorRate: number;

  // æœ¬åœ°æ‰©å±•
  localNotes?: string;
  tags?: string[];
  isFavorite?: boolean;
}
```

#### 2.4 æ›´æ–°å¯†é’¥
```typescript
PUT /api/keys/:id
{
  name?: string;
  localNotes?: string;
  tags?: string[];
  isFavorite?: boolean;

  // ä»¥ä¸‹å­—æ®µåŒæ­¥åˆ° CRS
  rateLimit?: number;
  status?: string;
}
```

#### 2.5 åˆ é™¤å¯†é’¥
```typescript
DELETE /api/keys/:id
```

**æµç¨‹**:
1. Portal è°ƒç”¨ CRS Admin API åˆ é™¤å¯†é’¥
2. Portal åˆ é™¤æœ¬åœ°æ˜ å°„å…³ç³»
3. Portal è®°å½•å®¡è®¡æ—¥å¿—

---

### 3. ä½¿ç”¨ç»Ÿè®¡ï¼ˆæ•°æ®æ¥è‡ª CRSï¼‰

#### 3.1 ä»ªè¡¨æ¿
```typescript
GET /api/dashboard

Response:
{
  overview: {
    totalKeys: number;
    activeKeys: number;
    todayCalls: number;
    todayTokens: number;
    errorRate: number;
  },

  trends: [
    {
      date: string;
      calls: number;
      tokens: number;
      errors: number;
    }
  ],

  modelDistribution: [
    {
      model: string;
      percentage: number;
      calls: number;
    }
  ],

  topKeys: [
    {
      id: string;
      name: string;
      calls: number;
    }
  ]
}
```

**æ•°æ®èšåˆ**:
1. ä»æœ¬åœ°è·å–ç”¨æˆ·çš„æ‰€æœ‰å¯†é’¥ ID
2. æ‰¹é‡æŸ¥è¯¢ CRS ç»Ÿè®¡æ•°æ®
3. èšåˆå¹¶è®¡ç®—
4. ç¼“å­˜ 1 åˆ†é’Ÿ

#### 3.2 ä½¿ç”¨ç»Ÿè®¡
```typescript
GET /api/stats?timeRange=7d&groupBy=day

Response:
{
  summary: {
    totalCalls: number;
    totalTokens: number;
    avgResponseTime: number;
    errorRate: number;
  },

  timeline: [
    {
      timestamp: string;
      calls: number;
      tokens: number;
      errors: number;
    }
  ],

  models: [
    {
      model: string;
      calls: number;
      tokens: number;
    }
  ]
}
```

#### 3.3 è°ƒç”¨æ—¥å¿—
```typescript
GET /api/logs?page=1&limit=50&keyId=xxx&status=error

Response:
{
  logs: [
    {
      id: string;
      timestamp: string;
      keyId: string;
      model: string;
      inputTokens: number;
      outputTokens: number;
      responseTime: number;
      status: 'success' | 'error';
      errorMessage?: string;
    }
  ],
  total: number;
}
```

---

### 4. å®‰è£…æŒ‡å¯¼ï¼ˆæœ¬åœ°å®ç°ï¼‰

#### 4.1 å¹³å°æ£€æµ‹
```typescript
GET /api/install/detect

Response:
{
  platform: 'windows' | 'macos' | 'linux';
  shell: 'bash' | 'zsh' | 'powershell';
  recommended: string;  // æ¨èçš„é…ç½®æ–¹å¼
}
```

#### 4.2 é…ç½®è„šæœ¬ç”Ÿæˆ
```typescript
POST /api/install/generate
{
  keyId: string;
  platform: string;
  environment: 'bash' | 'zsh' | 'powershell';
}

Response:
{
  envVars: string;      // ç¯å¢ƒå˜é‡é…ç½®
  codexConfig: string;  // Codex é…ç½®æ–‡ä»¶
  instructions: string[];  // å®‰è£…æ­¥éª¤
}
```

**ç”Ÿæˆå†…å®¹**:

**Bash/Zsh é…ç½®**:
```bash
# æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrc
export ANTHROPIC_BASE_URL="https://claude.just-play.fun/api"
export ANTHROPIC_AUTH_TOKEN="<ç”¨æˆ·å¯†é’¥>"
export CRS_OAI_KEY="<ç”¨æˆ·å¯†é’¥>"
```

**PowerShell é…ç½®**:
```powershell
# æ·»åŠ åˆ° PowerShell Profile
$env:ANTHROPIC_BASE_URL = "https://claude.just-play.fun/api"
$env:ANTHROPIC_AUTH_TOKEN = "<ç”¨æˆ·å¯†é’¥>"
$env:CRS_OAI_KEY = "<ç”¨æˆ·å¯†é’¥>"
```

**Codex é…ç½®æ–‡ä»¶**:
```toml
# ~/.codex/config.toml
[api]
base_url = "https://claude.just-play.fun/api"
api_key = "<ç”¨æˆ·å¯†é’¥>"

[auth]
token = "<ç”¨æˆ·å¯†é’¥>"
```

#### 4.3 å®‰è£…éªŒè¯
```typescript
POST /api/install/verify
{
  platform: string;
  environment: string;
}

Response:
{
  envVarsSet: boolean;
  codexConfigExists: boolean;
  claudeCodeInstalled: boolean;
  issues: string[];
}
```

---

## é¡¹ç›®è¾¹ç•Œ

### âœ… æˆ‘ä»¬æä¾›çš„æœåŠ¡

#### æ ¸å¿ƒæœåŠ¡
1. **ç”¨æˆ·ç®¡ç†** - å®Œå…¨æœ¬åœ°å®ç°
   - ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€è®¤è¯
   - ç”¨æˆ·ä¿¡æ¯ç®¡ç†
   - ä¼šè¯ç®¡ç†

2. **å¯†é’¥ç®¡ç†ç•Œé¢** - ä»£ç† CRS
   - å¯†é’¥ CRUD æ“ä½œç•Œé¢
   - æœ¬åœ°æ‰©å±•åŠŸèƒ½ï¼ˆå¤‡æ³¨ã€æ ‡ç­¾ã€æ”¶è—ï¼‰
   - ç”¨æˆ·-å¯†é’¥æ˜ å°„å…³ç³»

3. **æ•°æ®å¯è§†åŒ–** - æ•°æ®æ¥è‡ª CRS
   - ä»ªè¡¨æ¿
   - ä½¿ç”¨ç»Ÿè®¡å›¾è¡¨
   - è°ƒç”¨æ—¥å¿—å±•ç¤º

4. **å®‰è£…æŒ‡å¯¼** - æœ¬åœ°å®ç°
   - é…ç½®è„šæœ¬ç”Ÿæˆ
   - å¹³å°ç‰¹å®šçš„å®‰è£…æ­¥éª¤
   - ç¯å¢ƒæ£€æµ‹å’ŒéªŒè¯

#### å¢å€¼åŠŸèƒ½
5. **ä¸ªæ€§åŒ–**
   - å¯†é’¥å¤‡æ³¨å’Œæ ‡ç­¾
   - æ”¶è—åŠŸèƒ½
   - ä¸»é¢˜åˆ‡æ¢
   - è¯­è¨€é€‰æ‹©

6. **å®‰å…¨å®¡è®¡**
   - æ“ä½œæ—¥å¿—è®°å½•
   - ç™»å½•å†å²
   - å¼‚å¸¸æ£€æµ‹

---

### âŒ æˆ‘ä»¬ä¸æä¾›çš„æœåŠ¡

#### æ˜ç¡®ä¸åšçš„äº‹æƒ…

1. **å¯†é’¥ç”Ÿæˆé€»è¾‘**
   ```
   âŒ ä¸ç”Ÿæˆå¯†é’¥ï¼ˆç”± CRS ç”Ÿæˆï¼‰
   âŒ ä¸å­˜å‚¨å¯†é’¥ï¼ˆåªå­˜å‚¨æ˜ å°„å…³ç³»ï¼‰
   âŒ ä¸éªŒè¯å¯†é’¥ï¼ˆç”± CRS éªŒè¯ï¼‰
   ```

2. **API ä¸­è½¬æœåŠ¡**
   ```
   âŒ ä¸ä»£ç†ç”¨æˆ·çš„ Claude API è¯·æ±‚
   âŒ ä¸è½¬å‘ AI å¯¹è¯
   âŒ ä¸ç¼“å­˜ AI å“åº”
   âŒ ä¸åšè´Ÿè½½å‡è¡¡
   ```

3. **ä½¿ç”¨é‡è®¡ç®—**
   ```
   âŒ ä¸ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°ï¼ˆç”± CRS ç»Ÿè®¡ï¼‰
   âŒ ä¸è®¡ç®— Token æ•°ï¼ˆç”± CRS è®¡ç®—ï¼‰
   âŒ ä¸è®°å½•è°ƒç”¨æ—¥å¿—ï¼ˆç”± CRS è®°å½•ï¼‰
   ```

4. **é€Ÿç‡é™åˆ¶**
   ```
   âŒ ä¸å®æ–½é€Ÿç‡é™åˆ¶ï¼ˆç”± CRS å®æ–½ï¼‰
   âŒ ä¸åšæµé‡æ§åˆ¶ï¼ˆç”± CRS æ§åˆ¶ï¼‰
   ```

5. **æ¨¡å‹ç®¡ç†**
   ```
   âŒ ä¸ç®¡ç† AI æ¨¡å‹
   âŒ ä¸é…ç½®æ¨¡å‹é™åˆ¶ï¼ˆç”± CRS é…ç½®ï¼‰
   ```

---

### ğŸ”— ä¾èµ–å…³ç³»

#### å¼ºä¾èµ–
1. **CRS Admin API** - æ ¸å¿ƒä¾èµ–
   - å¿…é¡»å¯ç”¨æ‰èƒ½åˆ›å»º/åˆ é™¤å¯†é’¥
   - å¿…é¡»å¯ç”¨æ‰èƒ½è·å–ç»Ÿè®¡æ•°æ®
   - æ•…éšœæ—¶éœ€è¦é™çº§æ–¹æ¡ˆ

2. **PostgreSQL** - æ•°æ®å­˜å‚¨
   - ç”¨æˆ·æ•°æ®
   - æ˜ å°„å…³ç³»
   - å®¡è®¡æ—¥å¿—

3. **Redis** - ç¼“å­˜
   - CRS å“åº”ç¼“å­˜
   - ä¼šè¯å­˜å‚¨
   - é€Ÿç‡é™åˆ¶

#### å¯é€‰ä¾èµ–
4. **é‚®ä»¶æœåŠ¡** - é€šçŸ¥ï¼ˆæœªæ¥ï¼‰
   - å¯†ç é‡ç½®ï¼ˆPhase 2ï¼‰
   - é€šçŸ¥æé†’ï¼ˆPhase 3ï¼‰

---

## åŠŸèƒ½ä¼˜å…ˆçº§

### P0 - å¿…é¡»æœ‰ï¼ˆMVPï¼‰

- âœ… ç”¨æˆ·æ³¨å†Œç™»å½•
- âœ… å¯†é’¥åˆ—è¡¨å±•ç¤º
- âœ… å¯†é’¥åˆ›å»ºï¼ˆä»£ç† CRSï¼‰
- âœ… åŸºç¡€ç»Ÿè®¡å±•ç¤º
- âœ… å®‰è£…æŒ‡å¯¼é¡µé¢

### P1 - åº”è¯¥æœ‰ï¼ˆV1.0ï¼‰

- âœ… å¯†é’¥è¯¦æƒ…é¡µé¢
- âœ… å¯†é’¥æ›´æ–°å’Œåˆ é™¤
- âœ… ä»ªè¡¨æ¿ï¼ˆå®Œæ•´ï¼‰
- âœ… ä½¿ç”¨ç»Ÿè®¡å›¾è¡¨
- â³ æœ¬åœ°æ‰©å±•åŠŸèƒ½ï¼ˆå¤‡æ³¨ã€æ ‡ç­¾ï¼‰

### P2 - å¯ä»¥æœ‰ï¼ˆV1.5ï¼‰

- â³ è°ƒç”¨æ—¥å¿—æŸ¥è¯¢
- â³ é«˜çº§æœç´¢å’Œç­›é€‰
- â³ å¯¼å‡ºåŠŸèƒ½ï¼ˆCSVã€JSONï¼‰
- â³ ä¸ªæ€§åŒ–ä¸»é¢˜

### P3 - æœªæ¥æœ‰ï¼ˆV2.0ï¼‰

- â³ å›¢é˜Ÿåä½œåŠŸèƒ½
- â³ å¤šç§Ÿæˆ·æ”¯æŒ
- â³ Webhook é›†æˆ
- â³ API å¼€æ”¾å¹³å°

---

## éåŠŸèƒ½æ€§éœ€æ±‚

### æ€§èƒ½è¦æ±‚
- API å“åº”æ—¶é—´ < 100msï¼ˆä¸å« CRS è°ƒç”¨ï¼‰
- CRS ä»£ç†è¯·æ±‚ < 500ms
- é¡µé¢åŠ è½½æ—¶é—´ < 2s
- æ”¯æŒ 100 å¹¶å‘ç”¨æˆ·

### å®‰å…¨è¦æ±‚
- JWT ä»¤ç‰Œè®¤è¯
- HTTPS å¼ºåˆ¶
- å¯†ç  bcrypt åŠ å¯†ï¼ˆ10 roundsï¼‰
- SQL æ³¨å…¥é˜²æŠ¤ï¼ˆPrisma ORMï¼‰
- XSS/CSRF é˜²æŠ¤
- å®¡è®¡æ—¥å¿—å®Œæ•´

### å¯ç”¨æ€§è¦æ±‚
- æœåŠ¡å¯ç”¨æ€§ > 99%
- CRS æ•…éšœæ—¶é™çº§å¯ç”¨
- è‡ªåŠ¨æ•…éšœæ¢å¤
- æ•°æ®è‡ªåŠ¨å¤‡ä»½

### å…¼å®¹æ€§è¦æ±‚
- æµè§ˆå™¨ï¼šChrome 90+, Firefox 88+, Safari 14+, Edge 90+
- ç§»åŠ¨ç«¯ï¼šiOS 14+, Android 10+
- å“åº”å¼è®¾è®¡ï¼š320px - 2560px

---

## è´¨é‡æ ‡å‡†

### ä»£ç è´¨é‡
- æµ‹è¯•è¦†ç›–ç‡ > 80%
- æ— ä¸¥é‡å®‰å…¨æ¼æ´ï¼ˆSnyk æ‰«æï¼‰
- éµå¾ª ESLint è§„åˆ™
- TypeScript strict æ¨¡å¼
- æ‰€æœ‰ PR éœ€ Code Review

### ç”¨æˆ·ä½“éªŒ
- æ³¨å†Œæµç¨‹ < 1 åˆ†é’Ÿ
- åˆ›å»ºå¯†é’¥ < 30 ç§’
- ç•Œé¢ç®€æ´ç›´è§‚
- é”™è¯¯æç¤ºæ¸…æ™°
- åŠ è½½çŠ¶æ€åé¦ˆ

### è¿ç»´è´¨é‡
- è‡ªåŠ¨åŒ–éƒ¨ç½²
- ç›‘æ§å‘Šè­¦å®Œå–„ï¼ˆSentryï¼‰
- æ—¥å¿—å®Œæ•´å¯æŸ¥ï¼ˆWinstonï¼‰
- å¤‡ä»½æ¢å¤å¯é ï¼ˆæ¯æ—¥å¤‡ä»½ï¼‰

---

## æŠ€æœ¯é™åˆ¶

### CRS ä¾èµ–é™åˆ¶
- CRS API ä¸å¯ç”¨æ—¶ï¼Œå¯†é’¥ç®¡ç†åŠŸèƒ½å—é™
- CRS å“åº”æ…¢æ—¶ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ
- CRS æ•°æ®æ›´æ–°å»¶è¿Ÿï¼ˆæœ€å¤š 5 åˆ†é’Ÿï¼‰

### æ•°æ®åº“é™åˆ¶
- PostgreSQL å•è¡¨æœ€å¤§ 10GB
- å¹¶å‘å†™å…¥å—é™
- éœ€è¦å®šæœŸå½’æ¡£æ—§æ•°æ®

### Redis é™åˆ¶
- å•ä¸ª value æœ€å¤§ 512MB
- å†…å­˜é™åˆ¶éœ€è¦åˆç†è®¾ç½® TTL
- æ•…éšœæ—¶é™çº§åˆ°ç›´è¿ CRS

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-01-01
